<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · HybridVariationalInference.jl</title><meta name="title" content="Home · HybridVariationalInference.jl"/><meta property="og:title" content="Home · HybridVariationalInference.jl"/><meta property="twitter:title" content="Home · HybridVariationalInference.jl"/><meta name="description" content="Documentation for HybridVariationalInference.jl."/><meta property="og:description" content="Documentation for HybridVariationalInference.jl."/><meta property="twitter:description" content="Documentation for HybridVariationalInference.jl."/><meta property="og:url" content="https://EarthyScience.github.io/HybridVariationalInference.jl/"/><meta property="twitter:url" content="https://EarthyScience.github.io/HybridVariationalInference.jl/"/><link rel="canonical" href="https://EarthyScience.github.io/HybridVariationalInference.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>HybridVariationalInference.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EarthyScience/HybridVariationalInference.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="HybridVariationalInference"><a class="docs-heading-anchor" href="#HybridVariationalInference">HybridVariationalInference</a><a id="HybridVariationalInference-1"></a><a class="docs-heading-anchor-permalink" href="#HybridVariationalInference" title="Permalink"></a></h1><p>Documentation for <a href="https://github.com/EarthyScience/HybridVariationalInference.jl">HybridVariationalInference</a>.</p><ul><li><a href="#HybridVariationalInference.AbstractComponentArrayInterpreter"><code>HybridVariationalInference.AbstractComponentArrayInterpreter</code></a></li><li><a href="#HybridVariationalInference.AbstractHybridCase"><code>HybridVariationalInference.AbstractHybridCase</code></a></li><li><a href="#HybridVariationalInference.AbstractModelApplicator"><code>HybridVariationalInference.AbstractModelApplicator</code></a></li><li><a href="#HybridVariationalInference.ComponentArrayInterpreter-Tuple{}"><code>HybridVariationalInference.ComponentArrayInterpreter</code></a></li><li><a href="#HybridVariationalInference.ComponentArrayInterpreter"><code>HybridVariationalInference.ComponentArrayInterpreter</code></a></li><li><a href="#HybridVariationalInference.ComponentArrayInterpreter-Tuple{NamedTuple}"><code>HybridVariationalInference.ComponentArrayInterpreter</code></a></li><li><a href="#HybridVariationalInference.StaticComponentArrayInterpreter"><code>HybridVariationalInference.StaticComponentArrayInterpreter</code></a></li><li><a href="#HybridVariationalInference.as_ca"><code>HybridVariationalInference.as_ca</code></a></li><li><a href="#HybridVariationalInference.callback_loss"><code>HybridVariationalInference.callback_loss</code></a></li><li><a href="#HybridVariationalInference.compute_correlated_covars-Union{Tuple{T}, Tuple{Random.AbstractRNG, AbstractMatrix{T}}} where T"><code>HybridVariationalInference.compute_correlated_covars</code></a></li><li><a href="#HybridVariationalInference.construct_3layer_MLApplicator"><code>HybridVariationalInference.construct_3layer_MLApplicator</code></a></li><li><a href="#HybridVariationalInference.construct_ChainsApplicator"><code>HybridVariationalInference.construct_ChainsApplicator</code></a></li><li><a href="#HybridVariationalInference.flatten1-Tuple{ComponentArrays.ComponentVector}"><code>HybridVariationalInference.flatten1</code></a></li><li><a href="#HybridVariationalInference.front"><code>HybridVariationalInference.front</code></a></li><li><a href="#HybridVariationalInference.gen_cov_pred-Tuple{Random.AbstractRNG, DataType, Any, Any, Any, Integer}"><code>HybridVariationalInference.gen_cov_pred</code></a></li><li><a href="#HybridVariationalInference.gen_hybridcase_synthetic"><code>HybridVariationalInference.gen_hybridcase_synthetic</code></a></li><li><a href="#HybridVariationalInference.generate_ζ-Tuple{Any, Any, AbstractVector, AbstractMatrix, NamedTuple}"><code>HybridVariationalInference.generate_ζ</code></a></li><li><a href="#HybridVariationalInference.get_ca_starts-Tuple{ComponentArrays.ComponentVector}"><code>HybridVariationalInference.get_ca_starts</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_MLapplicator"><code>HybridVariationalInference.get_hybridcase_MLapplicator</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_PBmodel"><code>HybridVariationalInference.get_hybridcase_PBmodel</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_cor_starts-Tuple{AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_cor_starts</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_float_type-Tuple{AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_float_type</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_n_covar-Tuple{AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_n_covar</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_neg_logden_obs"><code>HybridVariationalInference.get_hybridcase_neg_logden_obs</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_par_templates"><code>HybridVariationalInference.get_hybridcase_par_templates</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_train_dataloader-Tuple{Random.AbstractRNG, AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_train_dataloader</code></a></li><li><a href="#HybridVariationalInference.get_hybridcase_transforms"><code>HybridVariationalInference.get_hybridcase_transforms</code></a></li><li><a href="#HybridVariationalInference.get_loss_gf-Tuple{Any, Any, Any, Any, HybridVariationalInference.AbstractComponentArrayInterpreter}"><code>HybridVariationalInference.get_loss_gf</code></a></li><li><a href="#HybridVariationalInference.gf-NTuple{7, Any}"><code>HybridVariationalInference.gf</code></a></li><li><a href="#HybridVariationalInference.handle_GPU_data-Tuple{AbstractGPUDataHandler, AbstractArray}"><code>HybridVariationalInference.handle_GPU_data</code></a></li><li><a href="#HybridVariationalInference.init_hybrid_params-NTuple{4, Any}"><code>HybridVariationalInference.init_hybrid_params</code></a></li><li><a href="#HybridVariationalInference.invsumn-Tuple{T} where T"><code>HybridVariationalInference.invsumn</code></a></li><li><a href="#HybridVariationalInference.neg_elbo_transnorm_gf-Tuple{Any, AbstractVector, Any, Any, Any, Any, AbstractMatrix, Any, Any, Any, NamedTuple}"><code>HybridVariationalInference.neg_elbo_transnorm_gf</code></a></li><li><a href="#HybridVariationalInference.neg_logden_indep_normal-Tuple{AbstractArray, AbstractArray, AbstractArray}"><code>HybridVariationalInference.neg_logden_indep_normal</code></a></li><li><a href="#HybridVariationalInference.predict_gf-Tuple{Any, Any, Any, AbstractVector, AbstractMatrix, Any, Any}"><code>HybridVariationalInference.predict_gf</code></a></li><li><a href="#HybridVariationalInference.predict_y-Tuple{Any, Any, Any, Bijectors.Transform, HybridVariationalInference.AbstractComponentArrayInterpreter}"><code>HybridVariationalInference.predict_y</code></a></li><li><a href="#HybridVariationalInference.sample_ζ_norm0-Tuple{Random.AbstractRNG, AbstractVector, AbstractMatrix, Vararg{Any}}"><code>HybridVariationalInference.sample_ζ_norm0</code></a></li><li><a href="#HybridVariationalInference.scale_centered_at"><code>HybridVariationalInference.scale_centered_at</code></a></li><li><a href="#HybridVariationalInference.select_ml_engine-Tuple{}"><code>HybridVariationalInference.select_ml_engine</code></a></li><li><a href="#HybridVariationalInference.transformU_block_cholesky1"><code>HybridVariationalInference.transformU_block_cholesky1</code></a></li><li><a href="#HybridVariationalInference.transformU_cholesky1-Tuple{AbstractVector}"><code>HybridVariationalInference.transformU_cholesky1</code></a></li><li><a href="#HybridVariationalInference.utri2vec-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T"><code>HybridVariationalInference.utri2vec</code></a></li><li><a href="#HybridVariationalInference.utri2vec_pos-Tuple{Any, Any}"><code>HybridVariationalInference.utri2vec_pos</code></a></li><li><a href="#HybridVariationalInference.uutri2vec-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T"><code>HybridVariationalInference.uutri2vec</code></a></li><li><a href="#HybridVariationalInference.vec2utri-Union{Tuple{AbstractVector{T}}, Tuple{T}} where T"><code>HybridVariationalInference.vec2utri</code></a></li><li><a href="#HybridVariationalInference.vec2utri_pos-Tuple{Any, Any}"><code>HybridVariationalInference.vec2utri_pos</code></a></li></ul><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.AbstractComponentArrayInterpreter" href="#HybridVariationalInference.AbstractComponentArrayInterpreter"><code>HybridVariationalInference.AbstractComponentArrayInterpreter</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractComponentArrayInterpreter</code></pre><p>Interface for Type that implements</p><ul><li><code>as_ca(::AbstractArray, interpreter) -&gt; ComponentArray</code></li><li><code>Base.length(interpreter) -&gt; Int</code></li></ul><p>When called on a vector, forwards to <code>as_ca</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L3-L11">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.AbstractHybridCase" href="#HybridVariationalInference.AbstractHybridCase"><code>HybridVariationalInference.AbstractHybridCase</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Type to dispatch constructing data and network structures for different cases of hybrid problem setups</p><p>For a specific case, provide functions that specify details</p><ul><li><code>get_hybridcase_MLapplicator</code></li><li><code>get_hybridcase_PBmodel</code></li><li><code>get_hybridcase_neg_logden_obs</code></li><li><code>get_hybridcase_par_templates</code></li><li><code>get_hybridcase_transforms</code></li><li><code>get_hybridcase_train_dataloader</code> (default depends on <code>gen_hybridcase_synthetic</code>)</li></ul><p>optionally</p><ul><li><code>gen_hybridcase_synthetic</code></li><li><code>get_hybridcase_n_covar</code> (defaults to number of rows in xM in train_dataloader )</li><li><code>get_hybridcase_float_type</code> (defaults to <code>eltype(θM)</code>)</li><li><code>get_hybridcase_cor_starts</code> (defaults to include all correlations: <code>(P=(1,), M=(1,))</code>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L1-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.AbstractModelApplicator" href="#HybridVariationalInference.AbstractModelApplicator"><code>HybridVariationalInference.AbstractModelApplicator</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractModelApplicator(x, ϕ)</code></pre><p>Abstraction of applying a machine learning model at covariate matrix, <code>x</code>, using parameters, <code>ϕ</code>. It returns a matrix of predictions with the same number of rows as in <code>x</code>.    </p><p>Constructors for specifics are defined in extension packages. Each constructor takes a special type of machine learning model and returns  a tuple with two components:</p><ul><li>The applicator </li><li>a sample parameter vector (type  depends on the used ML-framework)</li></ul><p>Implemented are</p><ul><li><code>construct_SimpleChainsApplicator</code></li><li><code>construct_FluxApplicator</code></li><li><code>construct_LuxApplicator</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ModelApplicator.jl#L1-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.ComponentArrayInterpreter" href="#HybridVariationalInference.ComponentArrayInterpreter"><code>HybridVariationalInference.ComponentArrayInterpreter</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Non-Concrete version of <code>AbstractComponentArrayInterpreter</code> that avoids storing additional type parameters.</p><p>Does not trigger specialization for Interpreters of different axes, but does not allow compiler-inferred <code>length</code> to construct StaticArrays.</p><p>Use <code>get_concrete(cai::ComponentArrayInterpreter)</code> to pass a concrete version to  performance-critical functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L47-L56">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.ComponentArrayInterpreter-Tuple{NamedTuple}" href="#HybridVariationalInference.ComponentArrayInterpreter-Tuple{NamedTuple}"><code>HybridVariationalInference.ComponentArrayInterpreter</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ComponentArrayInterpreter(; kwargs...)
ComponentArrayInterpreter(::AbstractComponentArray)
ComponentArrayInterpreter(::AbstractComponentArray, n_dims::NTuple{N,&lt;:Integer})
ComponentArrayInterpreter(n_dims::NTuple{N,&lt;:Integer}, ::AbstractComponentArray)</code></pre><p>Construct a <code>ComponentArrayInterpreter &lt;: AbstractComponentArrayInterpreter</code> with components being vectors of given length or given model of a <code>AbstractComponentArray</code>.</p><p>The other constructors allow constructing arrays with additional dimensions.</p><p>&#39;&#39;&#39;julia     interpreter = ComponentArrayInterpreter(; P=2, M=(2,3), Unc=5)     v = 1.0:length(interpreter)     interpreter(v).M == 2 .+ [1 3 5; 2 4 6]     vm = stack((v,v .* 10, v .* 100))</p><pre><code class="nohighlight hljs">intm = ComponentArrayInterpreter(interpreter(v), (3,))
intm(vm)[:Unc, 2]</code></pre><p>&#39;&#39;&#39;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L73-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.ComponentArrayInterpreter-Tuple{}" href="#HybridVariationalInference.ComponentArrayInterpreter-Tuple{}"><code>HybridVariationalInference.ComponentArrayInterpreter</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ComponentArrayInterpreter(; kwargs...)
ComponentArrayInterpreter(::AbstractComponentArray)
ComponentArrayInterpreter(::AbstractComponentArray, n_dims::NTuple{N,&lt;:Integer})
ComponentArrayInterpreter(n_dims::NTuple{N,&lt;:Integer}, ::AbstractComponentArray)</code></pre><p>Construct a <code>ComponentArrayInterpreter &lt;: AbstractComponentArrayInterpreter</code> with components being vectors of given length or given model of a <code>AbstractComponentArray</code>.</p><p>The other constructors allow constructing arrays with additional dimensions.</p><p>&#39;&#39;&#39;julia     interpreter = ComponentArrayInterpreter(; P=2, M=(2,3), Unc=5)     v = 1.0:length(interpreter)     interpreter(v).M == 2 .+ [1 3 5; 2 4 6]     vm = stack((v,v .* 10, v .* 100))</p><pre><code class="nohighlight hljs">intm = ComponentArrayInterpreter(interpreter(v), (3,))
intm(vm)[:Unc, 2]</code></pre><p>&#39;&#39;&#39;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L73-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.StaticComponentArrayInterpreter" href="#HybridVariationalInference.StaticComponentArrayInterpreter"><code>HybridVariationalInference.StaticComponentArrayInterpreter</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Concrete version of <code>AbstractComponentArrayInterpreter</code> that stores an axis in its type signature.</p><p>Allows compiler-inferred <code>length</code> to construct StaticArrays, but requires specialization on dispatch when provided as an argument to a function.</p><p>Use <code>get_concrete(cai::ComponentArrayInterpreter)</code> to pass a concrete version to  performance-critical functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L23-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.as_ca" href="#HybridVariationalInference.as_ca"><code>HybridVariationalInference.as_ca</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">as_ca(v::AbstractArray, interpretor)</code></pre><p>Returns a ComponentArray with underlying data <code>v</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L14-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.callback_loss" href="#HybridVariationalInference.callback_loss"><code>HybridVariationalInference.callback_loss</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>create a function (state, l) -&gt; false that prints iter and loss each moditer</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/util_opt.jl#L1-L3">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.compute_correlated_covars-Union{Tuple{T}, Tuple{Random.AbstractRNG, AbstractMatrix{T}}} where T" href="#HybridVariationalInference.compute_correlated_covars-Union{Tuple{T}, Tuple{Random.AbstractRNG, AbstractMatrix{T}}} where T"><code>HybridVariationalInference.compute_correlated_covars</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Create <code>n_covar</code> correlated covariates  from uncorrelated row-wise vector <code>x_pc</code>, with correlations <code>rhos</code> to the linear combinations of <code>x_pc</code>.</p><p>By default correlations, <code>rhos = (1.0),0.88,0.78,0.69,0.61 ...</code>,  decrease exponentially as <code>e^{-i/rhodec}</code>, with <code>rhodec = 8</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/gencovar.jl#L27-L34">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.construct_3layer_MLApplicator" href="#HybridVariationalInference.construct_3layer_MLApplicator"><code>HybridVariationalInference.construct_3layer_MLApplicator</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">construct_3layer_MLApplicator(
    rng::AbstractRNG, case::HVI.AbstractHybridCase, &lt;ml_engine&gt;;
    scenario::NTuple = ())</code></pre><p><code>ml_engine</code> usually is of type <code>Val{Symbol}</code>, e.g. Val(:Flux). See <code>select_ml_engine</code>.       </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ModelApplicator.jl#L39-L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.construct_ChainsApplicator" href="#HybridVariationalInference.construct_ChainsApplicator"><code>HybridVariationalInference.construct_ChainsApplicator</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">construct_ChainsApplicator([rng::AbstractRNG,] chain, float_type)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ModelApplicator.jl#L25-L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.flatten1-Tuple{ComponentArrays.ComponentVector}" href="#HybridVariationalInference.flatten1-Tuple{ComponentArrays.ComponentVector}"><code>HybridVariationalInference.flatten1</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Removes the highest level of keys. Keeps the reference to the underlying data, but changes the axis. If first-level vector has no sub-names, an error (Aguement Error tuple must be non-empty) is thrown.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ComponentArrayInterpreter.jl#L158-L163">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.front" href="#HybridVariationalInference.front"><code>HybridVariationalInference.front</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>omit the last n elements of an iterator</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L272">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.gen_cov_pred-Tuple{Random.AbstractRNG, DataType, Any, Any, Any, Integer}" href="#HybridVariationalInference.gen_cov_pred-Tuple{Random.AbstractRNG, DataType, Any, Any, Any, Integer}"><code>HybridVariationalInference.gen_cov_pred</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Generate correlated covariates and synthetic true parameters that are a linear combination of the uncorrelated underlying principal  factors and their binary combinations.</p><p>In addition provide a SimpleChains model of adequate complexity to fit this relationship θMs<em>true = f(x</em>o)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/gencovar.jl#L1-L8">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.gen_hybridcase_synthetic" href="#HybridVariationalInference.gen_hybridcase_synthetic"><code>HybridVariationalInference.gen_hybridcase_synthetic</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gen_hybridcase_synthetic([rng,] ::AbstractHybridCase; scenario)</code></pre><p>Setup synthetic data, a NamedTuple of</p><ul><li>xM: matrix of covariates, with one column per site</li><li>θP_true: vector global process-model parameters</li><li>θMs_true: matrix of site-varying process-model parameters, with </li><li>xP: Vector of process-model drivers, with an entry per site</li><li>y<em>global</em>true: vector of global observations</li><li>y_true: matrix of site-specific observations with one column per site</li><li>y<em>global</em>o, y_o: observations with added noise</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L102-L113">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.generate_ζ-Tuple{Any, Any, AbstractVector, AbstractMatrix, NamedTuple}" href="#HybridVariationalInference.generate_ζ-Tuple{Any, Any, AbstractVector, AbstractMatrix, NamedTuple}"><code>HybridVariationalInference.generate_ζ</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Generate samples of (inv-transformed) model parameters, ζ,  and the vector of standard deviations, σ, i.e. the diagonal of the cholesky-factor.</p><p>Adds the MV-normally distributed residuals, retrieved by <code>sample_ζ_norm0</code> to the means extracted from parameters and predicted by the machine learning model. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/elbo.jl#L73-L80">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_ca_starts-Tuple{ComponentArrays.ComponentVector}" href="#HybridVariationalInference.get_ca_starts-Tuple{ComponentArrays.ComponentVector}"><code>HybridVariationalInference.get_ca_starts</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_ca_starts(vc::ComponentVector)</code></pre><p>Return a tuple with starting positions of components in vc.  Useful for providing information on correlactions among subranges in a vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L263-L268">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_MLapplicator" href="#HybridVariationalInference.get_hybridcase_MLapplicator"><code>HybridVariationalInference.get_hybridcase_MLapplicator</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_MLapplicator([rng::AbstractRNG,] ::AbstractHybridCase; scenario=())</code></pre><p>Construct the machine learning model fro given problem case and ML-Framework and  scenario.</p><p>returns a Tuple of</p><ul><li>AbstractModelApplicator</li><li>initial parameter vector</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L21-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_PBmodel" href="#HybridVariationalInference.get_hybridcase_PBmodel"><code>HybridVariationalInference.get_hybridcase_PBmodel</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_PBmodel(::AbstractHybridCase; scenario::NTuple=())</code></pre><p>Construct the process-based model function  <code>f(θP::AbstractVector, θMs::AbstractMatrix, x) -&gt; (AbstractVector, AbstractMatrix)</code> with</p><ul><li>θP: calibrated parameters that are constant across site</li><li>θMs: calibrated parameters that vary across sites, with a  column for each site</li><li>x: drivers, indexed by site</li></ul><p>returns a tuple of predictions with components</p><ul><li>first, those that are constant across sites</li><li>second, those that vary across sites, with a column for each site</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L37-L50">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_cor_starts-Tuple{AbstractHybridCase}" href="#HybridVariationalInference.get_hybridcase_cor_starts-Tuple{AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_cor_starts</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_cor_starts(case::AbstractHybridCase; scenario)</code></pre><p>Specify blocks in correlation matrices among parameters. Returns a NamedTuple.</p><ul><li><code>P</code>: correlations among global parameters</li><li><code>M</code>: correlations among ML-predicted parameters</li></ul><p>Subsets ofparameters that are correlated with other but not correlated with parameters of other subranges are specified by indicating the starting position of each subrange. E.g. if within global parameter vector <code>(p1, p2, p3)</code>, <code>p1</code> and <code>p2</code> are correlated,  but parameter <code>p3</code> is not correlated with them, then the first subrange starts at position 1 and the second subrange starts at position 3. If there is only single block of all ML-predicted parameters being correlated  with each other then this block starts at position 1: <code>(P=(1,3), M=(1,))</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L149-L165">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_float_type-Tuple{AbstractHybridCase}" href="#HybridVariationalInference.get_hybridcase_float_type-Tuple{AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_float_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_float_type(::AbstractHybridCase; scenario)</code></pre><p>Determine the FloatType for given Case and scenario, defaults to Float32</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L116-L120">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_n_covar-Tuple{AbstractHybridCase}" href="#HybridVariationalInference.get_hybridcase_n_covar-Tuple{AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_n_covar</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_n_covar(::AbstractHybridCase; scenario)</code></pre><p>Provide the number of covariates. Default returns the number of rows in <code>xM</code> from <code>get_hybridcase_train_dataloader</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L89-L94">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_neg_logden_obs" href="#HybridVariationalInference.get_hybridcase_neg_logden_obs"><code>HybridVariationalInference.get_hybridcase_neg_logden_obs</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_neg_logden_obs(::AbstractHybridCase; scenario)</code></pre><p>Provide a <code>function(y_obs, ypred) -&gt; Real</code> that computes the negative logdensity of the observations, given the predictions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L53-L58">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_par_templates" href="#HybridVariationalInference.get_hybridcase_par_templates"><code>HybridVariationalInference.get_hybridcase_par_templates</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_par_templates(::AbstractHybridCase; scenario)</code></pre><p>Provide tuple of templates of ComponentVectors <code>θP</code> and <code>θM</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L62-L66">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_train_dataloader-Tuple{Random.AbstractRNG, AbstractHybridCase}" href="#HybridVariationalInference.get_hybridcase_train_dataloader-Tuple{Random.AbstractRNG, AbstractHybridCase}"><code>HybridVariationalInference.get_hybridcase_train_dataloader</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_train_dataloader([rng,] ::AbstractHybridCase; scenario)</code></pre><p>Return a DataLoader that provides a tuple of</p><ul><li><code>xM</code>: matrix of covariates, with one column per site</li><li><code>xP</code>: Iterator of process-model drivers, with one element per site</li><li><code>y_o</code>: matrix of observations with added noise, with one column per site</li><li><code>y_unc</code>: matrix <code>sizeof(y_o)</code> of uncertainty information </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L125-L133">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_hybridcase_transforms" href="#HybridVariationalInference.get_hybridcase_transforms"><code>HybridVariationalInference.get_hybridcase_transforms</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_hybridcase_transforms(::AbstractHybridCase; scenario)</code></pre><p>Return a NamedTupe of</p><ul><li><code>transP</code>: Bijectors.Transform for the global PBM parameters, θP</li><li><code>transM</code>: Bijectors.Transform for the single-site PBM parameters, θM</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/hybrid_case.jl#L70-L76">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.get_loss_gf-Tuple{Any, Any, Any, Any, HybridVariationalInference.AbstractComponentArrayInterpreter}" href="#HybridVariationalInference.get_loss_gf-Tuple{Any, Any, Any, Any, HybridVariationalInference.AbstractComponentArrayInterpreter}"><code>HybridVariationalInference.get_loss_gf</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Create a loss function for parameter vector p, given </p><ul><li>g(x, ϕ): machine learning model </li><li>f(θMs, θP): mechanistic model </li><li>xM: matrix of covariates, sites in columns</li><li>y_o: matrix of observations, sites in columns</li><li>int_ϕθP: interpreter attachin axis with compponents ϕg and pc.θP</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/gf.jl#L32-L39">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.gf-NTuple{7, Any}" href="#HybridVariationalInference.gf-NTuple{7, Any}"><code>HybridVariationalInference.gf</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>composition f ∘ transM ∘ g: mechanistic model after machine learning parameter prediction</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/gf.jl#L19-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.handle_GPU_data-Tuple{AbstractGPUDataHandler, AbstractArray}" href="#HybridVariationalInference.handle_GPU_data-Tuple{AbstractGPUDataHandler, AbstractArray}"><code>HybridVariationalInference.handle_GPU_data</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">(app::AbstractGPUDataHandler)(x) = handle_GPU_data(app, x)</code></pre><p>Callable applied to argument <code>x</code>, used to configure the exchange of data between GPU and CPU. By Default, nothing is done to x. Package extensions for Flux and Lux implement overloads for AbstractGPUArray that call <code>cpu(x)</code> to transfer data on the GPU to CPU. Those package extension also use <code>set_default_GPUHandler()</code> so that .</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/GPUDataHandler.jl#L3-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.init_hybrid_params-NTuple{4, Any}" href="#HybridVariationalInference.init_hybrid_params-NTuple{4, Any}"><code>HybridVariationalInference.init_hybrid_params</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">init_hybrid_params(θP, θM, ϕg, n_batch; transP=asℝ, transM=asℝ)</code></pre><p>Setup ComponentVector of parameters to optimize, and associated tools. Returns a NamedTuple of</p><ul><li>ϕ: A ComponentVector of parameters to optimize</li><li>transPMs<em>batch, interpreters: Transformations and interpreters as  required by `neg</em>elbo<em>transnorm</em>gf`.</li><li>get<em>transPMs: a function returning transformations `(n</em>site) -&gt; (;P,Ms)`</li><li>get<em>ca</em>int<em>PMs: a function returning ComponentArrayInterpreter for PMs vector  with PMs shaped as a matrix of `n</em>site<code>columns of</code>θM`</li></ul><p><strong>Arguments</strong></p><ul><li><code>θP</code>, <code>θM</code>: Template ComponentVectors of global parameters and ML-predicted parameters</li><li><code>ϕg</code>: vector of parameters to optimize, as returned by <code>get_hybridcase_MLapplicator</code></li><li><code>n_batch</code>: the number of sites to predicted in each mini-batch</li><li><code>transP</code>, <code>transM</code>: the Bijector.Transformations for the global and site-dependent    parameters, e.g. <code>Stacked(elementwise(identity), elementwise(exp), elementwise(exp))</code>.   Its the transformation froing from unconstrained to constrained space: θ = Tinv(ζ),   because this direction is used much more often.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/init_hybrid_params.jl#L1-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.invsumn-Tuple{T} where T" href="#HybridVariationalInference.invsumn-Tuple{T} where T"><code>HybridVariationalInference.invsumn</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Inverse of s = sumn(n) for positive integer <code>n</code>.</p><p>Gives an inexact error, if given s was not such a sum.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L3-L8">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.neg_elbo_transnorm_gf-Tuple{Any, AbstractVector, Any, Any, Any, Any, AbstractMatrix, Any, Any, Any, NamedTuple}" href="#HybridVariationalInference.neg_elbo_transnorm_gf-Tuple{Any, AbstractVector, Any, Any, Any, Any, AbstractMatrix, Any, Any, Any, NamedTuple}"><code>HybridVariationalInference.neg_elbo_transnorm_gf</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Cost function (ELBO) for hybrid model with batched sites.</p><p>It generates n_MC samples for each site, and uses these to compute the expected value of the likelihood of observations.</p><p><strong>Arguments</strong></p><ul><li><code>rng</code>: random number generator (ignored on CUDA, if ϕ is a AbstractGPUArray)</li><li><code>ϕ</code>: flat vector of parameters, interpreted by interpreters interpreted by interpreters.μP<em>ϕg</em>unc and interpreters.PMs</li><li><code>g</code>: machine learning model</li><li><code>transPMs</code>: Transformations as generated by get<em>transPMs returned from init</em>hybrid_params</li><li><code>f</code>: mechanistic model</li><li><code>py</code>: negative log-likelihood of observations given predictions:  <code>function(y_ob, y_pred, y_unc)</code></li><li><code>xM</code>: matrix of covariates (n<em>cov x n</em>site_batch)</li><li><code>xP</code>: model drivers, iterable of (n<em>site</em>batch)</li><li><code>y_ob</code>: matrix of observations (n<em>obs x n</em>site_batch)</li><li><code>y_unc</code>: observation uncertainty provided to py (same size as y_ob)</li><li><code>interpreters</code>: NamedTuple as generated by <code>gen_hybridcase_synthetic</code> with entries:<ul><li><code>μP_ϕg_unc</code>: extract components of parameter of <ol><li>means of global PBM, 2) ML-weights, and 3) additional parameters of approximation q</li></ol></li><li><code>PMs</code>: assign components to PBM parameters 1 global, 2 matrix of n_site column  vectors</li><li><code>int_unc</code> (can be omitted, if <code>μP_ϕg_unc(ϕ).unc</code> is already a ComponentVector)</li></ul></li><li><code>n_MC</code>: number of MonteCarlo samples from the distribution of parameters to simulate using the mechanistic model f.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/elbo.jl#L1-L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.neg_logden_indep_normal-Tuple{AbstractArray, AbstractArray, AbstractArray}" href="#HybridVariationalInference.neg_logden_indep_normal-Tuple{AbstractArray, AbstractArray, AbstractArray}"><code>HybridVariationalInference.neg_logden_indep_normal</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">neg_logden_indep_normal(obs, μ, logσ2s; σfac=1.0)</code></pre><p>Compute the negative Log-density of <code>θM</code> for multiple independent normal distributions, given estimated means <code>μ</code> and estimated log of variance parameters <code>logσ2s</code>.</p><p>All the arguments should be vectors of the same length. If <code>obs</code>,  <code>μ</code> are given as a matrix of several column-vectors, their summed Likelihood is computed, assuming each column having the same <code>logσ2s</code>.</p><p>Keyword argument <code>σfac</code> can be increased to put more weight on achieving a low uncertainty estimate and means closer to the observations to help an initial fit. The obtained parameters then can be used as starting values for a the proper fit with <code>σfac=1.0</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/logden_normal.jl#L1-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.predict_gf-Tuple{Any, Any, Any, AbstractVector, AbstractMatrix, Any, Any}" href="#HybridVariationalInference.predict_gf-Tuple{Any, Any, Any, AbstractVector, AbstractMatrix, Any, Any}"><code>HybridVariationalInference.predict_gf</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">predict_gf(rng, g, f, ϕ::AbstractVector, xM::AbstractMatrix, interpreters;
    get_transPMs, get_ca_int_PMs, n_sample_pred=200, 
    gpu_data_handler=get_default_GPUHandler())</code></pre><p>Prediction function for hybrid model. Returns an Array <code>(n_obs, n_site, n_sample_pred)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/elbo.jl#L50-L56">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.predict_y-Tuple{Any, Any, Any, Bijectors.Transform, HybridVariationalInference.AbstractComponentArrayInterpreter}" href="#HybridVariationalInference.predict_y-Tuple{Any, Any, Any, Bijectors.Transform, HybridVariationalInference.AbstractComponentArrayInterpreter}"><code>HybridVariationalInference.predict_y</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Compute predictions and log-Determinant of the transformation at given transformed parameters for each site. </p><p>The number of sites is given by the number of columns in <code>Ms</code>, which is determined by the transformation, <code>transPMs</code>.</p><p>Steps:</p><ul><li>transform the parameters to original constrained space</li><li>Applies the mechanistic model for each site</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/elbo.jl#L168-L179">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.sample_ζ_norm0-Tuple{Random.AbstractRNG, AbstractVector, AbstractMatrix, Vararg{Any}}" href="#HybridVariationalInference.sample_ζ_norm0-Tuple{Random.AbstractRNG, AbstractVector, AbstractMatrix, Vararg{Any}}"><code>HybridVariationalInference.sample_ζ_norm0</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Extract relevant parameters from θ and return n_MC generated draws together with the vector of standard deviations, σ.</p><p><strong>Arguments</strong></p><p><code>int_unc</code>: Interpret vector as ComponentVector with components    ρsP, ρsM, logσ2<em>logP, coef</em>logσ2_logMs(intercept + slope), </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/elbo.jl#L100-L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.scale_centered_at" href="#HybridVariationalInference.scale_centered_at"><code>HybridVariationalInference.scale_centered_at</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">scale_centered_at(x, m, σrel=1.0)
scale_centered_at(x, m, σ)</code></pre><p>Centers and rescales rows of matrix <code>x</code> around vector <code>m</code>. The scale can either be given relative to <code>m</code> or specified as a vector of same size as <code>m</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/gencovar.jl#L49-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.select_ml_engine-Tuple{}" href="#HybridVariationalInference.select_ml_engine-Tuple{}"><code>HybridVariationalInference.select_ml_engine</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">select_ml_engine(;scenario)</code></pre><p>Returns a value type <code>Val{:Symbol}</code> to dispatch on the machine learning engine to use.</p><ul><li>defaults to <code>Val(:SimpleChains)</code></li><li><code>:use_Lux ∈ scenario -&gt; Val(:Lux)</code></li><li><code>:use_Flux ∈ scenario -&gt; Val(:Flux)</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/ModelApplicator.jl#L48-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.transformU_block_cholesky1" href="#HybridVariationalInference.transformU_block_cholesky1"><code>HybridVariationalInference.transformU_block_cholesky1</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transformU_block_cholesky1(v::AbstractVector, cor_starts = (1,))</code></pre><p>Transform a parameterization v of a blockdiagonal of upper triangular matrices into the this matrix. <code>cor_starts</code> is a NTuple of Integeres specifying the first column of each block.  E.g. For a matrix with a 3x3, a 2x2, and another block,  the blocks start at columns (1,4,6). It defaults to a single entire block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L275-L283">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.transformU_cholesky1-Tuple{AbstractVector}" href="#HybridVariationalInference.transformU_cholesky1-Tuple{AbstractVector}"><code>HybridVariationalInference.transformU_cholesky1</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Takes a vector of entries of a lower UnitUpperTriangular matrix and transforms it to an UpperTriangular that satisfies  diag(U&#39; * U) = 1.</p><p>This can be used to fit parameters that yield an upper Cholesky-Factor of a Covariance matrix.</p><p>It uses the upper triangular matrix rather than the lower because it involes a sum across columns, whereas the alternative of a lower triangular uses sum across rows.  Sum across columns is often faster, because entries of columns are contiguous.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L224-L236">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.utri2vec-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T" href="#HybridVariationalInference.utri2vec-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T"><code>HybridVariationalInference.utri2vec</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Extract entries of upper diagonal matrix of UppterTriangular to columnwise vector</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L128-L130">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.utri2vec_pos-Tuple{Any, Any}" href="#HybridVariationalInference.utri2vec_pos-Tuple{Any, Any}"><code>HybridVariationalInference.utri2vec_pos</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Compute the index in the vector of entries in an upper tridiagonal matrix</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L57-L59">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.uutri2vec-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T" href="#HybridVariationalInference.uutri2vec-Union{Tuple{AbstractMatrix{T}}, Tuple{T}} where T"><code>HybridVariationalInference.uutri2vec</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Extract entries of upper diagonal matrix of UnitUppterTriangular to columnwise vector</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L150-L152">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.vec2utri-Union{Tuple{AbstractVector{T}}, Tuple{T}} where T" href="#HybridVariationalInference.vec2utri-Union{Tuple{AbstractVector{T}}, Tuple{T}} where T"><code>HybridVariationalInference.vec2utri</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Convert vector v columnwise entries of upper diagonal matrix to UppterTriangular</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L11-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="HybridVariationalInference.vec2utri_pos-Tuple{Any, Any}" href="#HybridVariationalInference.vec2utri_pos-Tuple{Any, Any}"><code>HybridVariationalInference.vec2utri_pos</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Compute the (one-based) position <code>(row, col)</code> within an upper tridiagonal matrix for given (one-based) position, <code>s</code> within a packed vector representation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthyScience/HybridVariationalInference.jl/blob/357f1ec175b14df293c368059d88ec1b67a121bb/src/cholesky.jl#L44-L48">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 30 January 2025 11:53">Thursday 30 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
